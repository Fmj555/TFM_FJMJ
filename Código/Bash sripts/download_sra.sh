#!/bin/bash

# Directorio de salida para las descargas
OUTPUT_DIR="sra_downloads"
mkdir -p "$OUTPUT_DIR"

# Lista de SRR/ERR IDs
SRR_IDS=(
    "SRR26436256" "SRR26436257" "SRR26436258"
    "SRR26436259" "SRR26436260" "SRR26436261" "SRR26436262" "SRR26436263"
    "SRR26436264" "SRR26436265" "SRR26436266" "SRR26436267" "SRR26436268"
    "SRR26436269" "SRR26436270" "SRR26436271" "SRR26436272" "SRR26436273"
    "SRR26436274" "SRR26436275" "SRR26436276" "SRR26436277" "SRR32302922"
    "SRR32302923" "SRR32302924" "SRR32302925" "SRR32302926" "SRR32302927"
    "SRR32302928" "SRR32302929" "SRR32302930" "SRR32302931" "SRR32302932"
    "SRR32302933" "SRR32302934" "SRR32302935" "SRR32302936" "SRR32302937"
    "SRR32302938" "SRR32302939" "ERR14652031" "ERR14378438" "ERR14376945"
    "ERR14376814" "ERR14652006" "ERR14378320" "ERR14651992" "ERR14376932"
    "ERR14377644" "ERR14376951" "ERR14378529" "ERR14378447" "ERR14376811"
    "ERR14376969" "ERR14378746" "ERR14376939" "ERR14378739" "ERR14377269"
    "ERR14377283" "ERR14652221" "ERR14652004" "ERR14651999" "ERR14376976"
    "ERR14652000" "ERR14378329" "ERR14377300" "ERR14652220" "ERR14376967"
    "ERR14651996" "ERR14378319" "ERR14376933" "ERR14377653" "ERR14378453"
    "ERR14652001" "ERR14651994" "ERR14652217" "ERR14379067" "ERR14378719"
    "ERR14652003" "ERR14377279" "ERR14652219" "ERR14376930" "ERR14378750"
    "ERR14376950" "ERR14652032" "ERR14378603" "ERR14378328" "ERR14377638"
    "ERR14379096" "ERR14378721" "ERR14376810" "ERR14376949" "ERR14377324"
    "ERR14377257" "ERR14652223" "ERR14376970" "ERR14377325" "ERR14376931"
    "ERR14378738" "ERR14376946" "ERR14377302" "ERR14652224" "ERR14652007"
    "ERR14377330" "ERR14376971" "ERR14652225" "ERR14652010" "ERR14651997"
    "ERR14376938" "ERR14378747" "ERR14652218" "ERR14376968" "ERR14652009"
    "ERR14377639" "ERR14376813" "ERR14652005" "ERR14377329" "ERR14378718"
    "ERR14651995" "ERR14378715" "ERR14376809" "ERR14651998" "ERR14377642"
    "ERR14377271" "ERR14376952" "ERR14378720" "ERR14376812" "ERR14378751"
    "ERR14652002" "ERR14376972" "ERR14652008" "ERR14652222" "ERR14377284"
    "ERR14377280" "ERR14651993" "ERR14378454" "ERR14378436" "ERR14377678"
    "SRR30982322" "SRR30982323" "SRR30982324" "SRR30982325" "SRR30982326"
    "SRR30982327" "SRR30982328" "SRR30982329" "SRR28372921" "SRR28372922"
    "SRR28372923" "SRR28372924" "SRR28372925" "SRR28372926" "SRR28372927"
    "SRR28372928" "SRR28372929" "SRR28372930" "SRR28372931" "SRR28372932"
    "SRR28372933" "SRR28372934" "SRR28372935" "SRR28372936" "SRR19735893"
    "SRR19735894" "SRR19735895" "SRR19735896" "SRR19735897" "SRR19735898"
    "SRR29429388" "SRR29429389" "SRR29429390" "SRR29429391" "SRR29429392"
    "SRR29429393" "SRR29429394" "SRR29429395" "SRR29429396" "SRR29429397"
    "SRR29429398" "SRR29429399" "SRR31428944" "SRR31428945" "SRR31428946"
    "SRR31428947" "SRR31428948" "SRR31428949" "SRR31428950" "SRR31428951"
    "SRR31428952" "SRR31428953" "SRR31428954" "SRR31428955" "SRR31428956"
    "SRR31428957" "SRR31428958" "SRR31428959" "SRR31428960" "SRR31428961"
    "SRR31428962" "SRR31428963" "SRR31428964" "SRR31428965" "SRR31428966"
    "SRR31428967" "SRR2002284" "SRR31037487" "SRR31037488" "SRR31037489"
    "SRR31037490" "SRR31037491" "SRR31037492" "SRR31037493" "SRR31037494"
    "SRR31037495" "SRR21134973" "SRR21134974" "SRR21134975" "SRR21134976"
    "SRR21134977" "SRR21134978" "SRR21134979" "SRR21134980" "SRR21134981"
    "SRR21134982" "SRR21134983" "SRR21134984" "SRR21847257" "SRR21847258"
    "SRR21847259" "SRR21847260" "SRR21847261" "SRR21847262" "SRR21847263"
    "SRR21847264" "SRR21847265" "SRR21847266" "SRR21847267" "SRR21847268"
    "SRR21847269" "SRR21847270" "SRR21847271" "SRR21847272" "SRR21847273"
    "SRR21847274" "SRR31181209" "SRR31181210" "SRR31181211" "SRR31181212"
    "SRR31181213" "SRR31181214" "SRR31181215" "SRR31181216" "SRR31181217"
    "SRR31181218" "SRR31181219" "SRR31181220" "SRR29822304" "SRR29822305"
    "SRR29822306" "SRR29822307" "SRR29822308" "SRR29822309" "ERR14096498"
    "ERR14096489" "ERR14096493" "ERR14096495" "ERR14096497" "ERR14096496"
    "ERR14096487" "ERR14096490" "ERR14096499" "ERR14096501" "ERR14096492"
    "ERR14096491" "ERR14096484" "ERR14096500" "ERR14096486" "ERR14096488"
    "ERR14096485" "ERR14096494"
)


# N√∫mero m√°ximo de reintentos
MAX_RETRIES=3

# Funci√≥n para descargar y convertir un SRR ID
download_sra() {
  local srr_id=$1
  local retries=$2

  echo "üì• Descargando $srr_id..."
  prefetch "$srr_id" || { echo "‚ùå Error al descargar $srr_id"; return 1; }

  echo "üîÑ Convirtiendo $srr_id a FASTQ..."
  fasterq-dump "$srr_id" -O "$OUTPUT_DIR" --split-files || { echo "‚ùå Error al convertir $srr_id a FASTQ"; return 1; }
   # Comprimir los archivos FASTQ generados
  echo "üîß Comprimiendo archivos FASTQ..."
  gzip "$OUTPUT_DIR/${srr_id}_1.fastq" "$OUTPUT_DIR/${srr_id}_2.fastq" || { echo "‚ùå Error al comprimir los archivos FASTQ"; return 1; }

  echo "‚úÖ Completado: $srr_id"
  return 0
}

# Funci√≥n para intentar la descarga con reintentos
download_with_retries() {
  local srr_id=$1
  local retries=$2
  local attempt=1

  while [ $attempt -le $retries ]; do
    download_sra "$srr_id" "$attempt" && return 0
    echo "üîÅ Intento $attempt de $retries fallido para $srr_id. Reintentando..."
    sleep $((RANDOM % 5 + 1))  # Espera aleatoria entre 1 y 5 segundos
    attempt=$((attempt + 1))
  done

  echo "‚ùå No se pudo descargar y convertir $srr_id despu√©s de $retries intentos."
  return 1
}

# Descargar y convertir cada SRR ID
for srr_id in "${SRR_IDS[@]}"; do
  download_with_retries "$srr_id" "$MAX_RETRIES"
done

echo "üéâ Todas las descargas y conversiones han finalizado."
